<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="View.DetailsLivrePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <!-- Titre du livre -->
            <Label Text="{Binding Livre.Titre}"
                   FontSize="28"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   HorizontalTextAlignment="Center"
                   TextColor="{StaticResource Primary}"/>

            <!-- Auteur -->
            <Label Text="{Binding Livre.Auteur}" 
                   FontSize="18"
                   HorizontalOptions="Center"
                   TextColor="Gray"/>

            <BoxView HeightRequest="1" Color="LightGray" />

            <!-- Informations détaillées (Maison d'édition, Date, ISBN) -->
            <Grid ColumnDefinitions="Auto, *" RowDefinitions="Auto, Auto, Auto" RowSpacing="5" ColumnSpacing="10">

                <Label Grid.Row="0" Grid.Column="0" Text="ISBN :" FontAttributes="Bold" />
                <Label Grid.Row="0" Grid.Column="1" Text="{Binding Livre.ISBN}" />

                <Label Grid.Row="1" Grid.Column="0" Text="Éditeur :" FontAttributes="Bold" />
                <Label Grid.Row="1" Grid.Column="1" Text="{Binding Livre.MaisonEdition}" />

                <Label Grid.Row="2" Grid.Column="0" Text="Date :" FontAttributes="Bold" />
                <Label Grid.Row="2" Grid.Column="1" Text="{Binding Livre.DatePublication}" />

            </Grid>

            <BoxView HeightRequest="1" Color="LightGray" />

            <!-- Résumé / Description -->
            <VerticalStackLayout Spacing="5">
                <Label Text="Résumé" FontAttributes="Bold" FontSize="16" />
                <Label Text="{Binding Livre.Description}" 
                       LineBreakMode="WordWrap" />
            </VerticalStackLayout>

            <!-- Note moyenne et Nombre d'avis -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}" 
                   CornerRadius="10" 
                   Padding="10">
                <HorizontalStackLayout Spacing="15" HorizontalOptions="Center">
                    <Label Text="{Binding Moyenne, StringFormat='⭐ Note : {0:F1}/5'}" 
                           FontAttributes="Bold" FontSize="16"/>
                    <Label Text="|" TextColor="Gray"/>
                    <Label Text="{Binding NombreEvaluations, StringFormat='{0} avis'}" 
                           FontSize="16"/>
                </HorizontalStackLayout>
            </Frame>

            <!-- Zone pour noter le livre -->
            <VerticalStackLayout Spacing="10" Margin="0,10,0,0">
                <Label Text="Votre évaluation :" FontAttributes="Bold" />

                <!-- Remplacement du Stepper par un Slider -->
                <Slider Minimum="0"
                        Maximum="5"
                        Value="{Binding NoteUtilisateur}" 
                        ThumbColor="{StaticResource Primary}"
                        MinimumTrackColor="{StaticResource Primary}"
                        MaximumTrackColor="LightGray" />

                <!-- Affichage de la valeur choisie juste en dessous -->
                <Label Text="{Binding NoteUtilisateur, StringFormat='Vous donnez : {0:F1}/5'}" 
                       HorizontalOptions="Center"
                       FontSize="16" 
                       TextColor="{StaticResource Primary}"
                       FontAttributes="Bold"/>

                <Button Text="Enregistrer mon avis"
                        Command="{Binding SauvegarderEvaluationCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        Margin="0,10,0,0"/>

                <Label Text="{Binding Message}"
                       TextColor="Red"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>